# W03_Gamma   
   
__1. Gamma__    
* Gamma: 화면의 밝기를 나타내는 곡선     
디스플레이마다 표현할 수 있는 능력이 다름     
기기에 따라 실제 이미지가 갖는 밝기를 제대로 표현하지 못함     
     
     jpg로 저장하면 감마가 인코딩 된 상태로 저장     
     감마 2.2가 규격이었기 때문에 jpg나 png 등 srgb포맷은 곡선을 지님    
<br/>

* Gamma Encoding(감마부호화)     
     * 목적: 주어진 대역폭 혹은 정보양 내에서 최대한의 '화질'을 보여주기 위함      
     * 역사적으로 __CRT디스플레이(브라운관)에서__ 전송하는 데이터는 선형이기 때문에 최종이미지의 중간톤이 어두워졌다.     
          이를 원하는 밝기로 보내기 위해 역으로 __밝게 해주는 과정__     
          >CRT 디스플레이의 지수 응답 곡선은 대략 y = x 2.2 였으므로 방송국에서 이를 지수 1/2.2로 전송 신호(x)를 인코딩하여     
           보정하기로 결정     
          따라서 감마 2.2가 규격이 됨
     * 인간의 시각이 밝기에 대해 비선형적으로 반응하기 때문에 최적의 화질을 보여주기 위해선 __비선형적으로__ 데이터를 인코딩하여 어두운 부분을 더 자세히 기록해주는 과정             
     (*비선형적:비례하지 않고 변화 / *선형적: 직선적으로 비례하여 변화)                
     
        =인간은 시각적인 부분에서 밝은 구역보다 어두운 구역의 변화에 민감하기 때문에 어두운 구역의 정밀도를 높이기 위해 사용     
        ex. 어두운 부분의 25,26 차이는 매우 크게 느끼지만 밝은 부분의 200,201 차이는 크게 못느낌     
        > 선형으로 인코딩 하면 밝은 부분에서 시각이 지각할 수 없는 필요없는 데이터가 많아지고,     
          어두운 부분에서는 데이터가 부족해서 화질이 떨어짐=계단현상(banding현상) 발생     
<br/>

https://mgun.tistory.com/1166           
https://blog.naver.com/dmatrix/221294895574               
http://egloos.zum.com/shotgunlee/v/10607756            

<br/>

* Gamma Correction (감마보정)     
     * CRT디스플레이와 달리 오늘날의 평면스크린 모니터와 텔레비전은 선형응답을 가지고있으나 이미 감마 인코딩이 업계 표준이 됨     
     ex. jpg나 png 등 sRGB포맷은 곡선을 지님 (저장할 때 감마가 인코딩 된 상태로 저장 = 원래보다 더 밝게 저장)                 
     * 따라서 선형 모니터와 텔레비전은 이 밝게 저장된 이미지를 다시 __감마 보정을 하여 어둡게__ 만들어야 결과적으로 우리가 원하는 원본 이미지를 출력 가능     
     <br/>
     
     ![2105879620_FmMCnAa0_Gamma01](https://user-images.githubusercontent.com/90597915/137688701-0ee31c72-f39c-4fe3-86c4-02c63e3978a2.png)      
> 흰 선: 실제 밝기 강도, 녹색 선: 우리 눈이 받아들이는 밝기 강도      
a=Linear Color Space, b=Gamma Color Space           
실제 수학적으로 정확한 그라데이션은 a, 하지만 사람의 눈은 어두운 색에 민감하기 때문에 b를 자연스럽게 느낌     
따라서 a처럼 선형적인 값을 b와 같이 비선형인 값으로 보정 (=중간 값을 다소 어둡게 만들어줌) =감마2.2      

이렇게 감마값을 보정한 이미지는 감마 색 공간에 있다고 함           
감마값을 보정하지 않은, 원래 이 세상에 존재하는 색 분포 그대로의 이미지는 선형 색 공간에 있다고 함
 http://hornil.com/bbs/board.php?bo_table=sp_tip_kr&wr_id=2  
  <br/>

![118792515-af61d780-b8d2-11eb-83fc-acc6de68c077](https://user-images.githubusercontent.com/90597915/137751704-d16fa555-9995-47bf-a5dd-7417b3bdbcae.png)     
이미지 파일은 왼쪽 이미지처럼 밝게 저장되어있는데, 디스플레이 장치는 이를 오른쪽 이미지처럼 만드려고 하다보니      
두 효과가 서로 상쇄되어 가운데 이미지가 출력되는 것     
https://kyoungwhankim.github.io/ko/blog/color_linearworkflow/
     <br/>
     <br/>
     
![Gamma-Signal-v01-640x252](https://user-images.githubusercontent.com/90597915/137720266-347ec88a-f9c7-44b8-95f0-8475b80b04ae.jpg)     
포토샵 등 대부분 프로그램에서는 감마 보정 자동으로 해줌 (안하면 훨씬 더 밝은 이미지로 표현 됨)     
https://www.japanistry.com/understanding-gamma-in-photography/           
<br/>
<br/>

__2. Linear Workflow__   
<br/>
* 모든 그래픽 작업이 선형 색 공간(Linear Color Space)에서 이루어지는 방식 <br/>
     >이미지를 저장할 때 중요! 이미지를 export할 때 올바른 color space를 골라준다
<br/>

* 우리가 2D, 3D 그래픽 툴을 사용할 때 jpeg와 같은 이미지 파일을 쓰기 마련     
근데 이 이미지 파일들은 이미 감마 보정을 통해 한 번 밝게 만들어진 이미지들이다.      
이런 이미지 파일들을 임의로 수정하거나 임의의 효과를 적용하면 왜곡된 결과가 나올 수 있다. 
<br/>

![118798092-3a919c00-b8d8-11eb-95de-4dfd46ec7526](https://user-images.githubusercontent.com/90597915/137753849-c20a27ce-7dd4-4c6b-aa8d-8966cd7b17f0.png)
<br/>
* 예컨대 위와 같이 색의 블랜딩을 할 경우, 선형 색 공간에서의 블랜딩은 밝은 부분이 자연스럽게 합쳐지지만, 감마 색 공간에서의 블랜딩은 밝은 부분이 지나치게 진하고 경계가 생김          
* 그 이유는 감마 색 공간에서의 이미지들은 위에서 봤듯 한 번 밝아진 상태의 이미지들이며, 선형 색 공간에서의 이미지들은 밝아진 이미지에 역으로 감마 보정을 가하여 원래 색상과 밝기로 되돌린 이미지들이기 때문      
* 따라서 선형 색 공간에서 작업을 하는 것이 권장되며 마지막 렌더링 시 다시 감마 인코딩을 통해 밝게 만들고, 이렇게 저장된 이미지들은 디스플레이 장치에서 다시금 어둡게 조정되어 우리가 기대하는 이미지로 출력됨     
https://kyoungwhankim.github.io/ko/blog/color_linearworkflow/
<br/>

* 즉, 8비트 sRGB파일들의 감마이슈로 인해 보정을 해줘야하는데       
 리니어 작업을 해주지 않으면 저장했을 때 커브가 더 과하게 표현(더 밝게, 더 어둡게)될 수 있기 때문에 하는 것      
 (Gamma 1이 리니어 커브)
 <br/>
 
 요즘은 자동으로 degamma를 해서 리니어로 보이도록 보정을 해줌     
 마야에서 불러온 jpg 파일이 더 어둡게/밝게 보인다하면 컬러스페이스를 sRGB로 바꿔주면 됨
 <br/>
 <br/>

* 정리      

      -모든 이미지(텍스쳐)는 감마공간에 있음 = Gamma Correction이 적용되어있음 (원본보다 밝게 되어있는)
       (ie. normal map처럼 이미지파일이지만 색상값을 저장하지 않고 데이터를 저장하는 이미지들은 눈에 보여질 용도가 아니므로 Gamma Correction이 적용되어 있지 않다)
      -모니터는 감마공간에 있는 이미지를 선형으로 보여주는 역할을 함 (다시 어둡게 해서 원본처럼 보이게 하는) 
      -감마공간에 있는 이미지를 선형공간으로 꺼내서 작업을 해야함 : 타는 듯한 현상 방지 위해 (밝은 걸 어둡게 해서 평평한 선형) 
      -이를 다시 감마공간으로 (밝아짐) 
      -출력할 때는 모니터가 다시 어둡게 해서 평평한 선형       

![2021-10-19 00 04 25](https://user-images.githubusercontent.com/90597915/137758589-9089d167-00a8-4e99-87e6-0991d97ef186.png)     
https://mgun.tistory.com/1166
 <br/>
 <br/>
 
 __3.Aces__
  <br/>
   <br/>

 ACES: Academy Color Encoding System
 <br/>

   * 색에 대한 업계 표준으로 설계
   * 촬영부터 후반작업, 배급에 이르기까지 모든 유형의 컬러 매니지먼트에 대한 일련의 가이드라인 및 설명서
   * 인간이 볼 수 있는 모든 색을 포함하고 있으며, 이것은 컬러 스페이스의 제약이나 제한이 없다는 것을 의미
   * 일관성과 하이퀄리티 컬러 매니지먼트를 유지하는 동시에 통합 문제를 해결하기 위해 만들어짐     
https://blog.naver.com/baekhyebin/222092359528
 
 ![rec 2020-vs-rec 709 001](https://user-images.githubusercontent.com/90597915/137763786-0868f5d5-24f7-409d-8b7e-db9c04c3075e.jpg)      
 https://docs.nvidia.com/gameworks/content/devices/shield-hdr-dev-guide/hdr-dev-guide-nvidia-shield.htm
 <br/>
 <br/>
 
 __4. Premultiplication__
 <br/>
 
* Pre-multipl-icat-ion      
프리멀티를 통해 풀컬러픽셀(RGBA)를 표현      
투명한 걸 얹어주는 작업을 하기 전에 RGB를 곱해줌      

        ex. (r,g,b)      
        (0.3, 0.1, 0.7) x0 　투명      
                        x1　 불투명      
                        x0.2 반투명
 <br/>
 <br/>
 
 __포토샵 데모__
  <br/>
  
 디스플레이용 해상도는 72 (디스플레이가 표현할 수 있는 최대, 그 이상은 오버스펙)      
인쇄용은 300
 <br/>
 
8bit의 경우 Color Profile(컬러스페이스 옵션)은 웬만하면 sRGB      
16/32bit는 Linear Space를 많이 사용하기 때문에 다양한 컬러스페이스 중에서 최종 상영할 것에 맞춰 선택할 수 있음


